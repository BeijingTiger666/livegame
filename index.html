<!DOCTYPE html>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>一维元胞自动机</title>
    <!-- 避免IE使用兼容模式 -->
 	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="./css/bootstrap.min.css" rel="stylesheet"/>
    <link href="./css/font-awesome.min.css" rel="stylesheet"/>
    <style>
        span.o{
            background-color: #d1dade;
            color: #5e5e5e;
            font-size: 10px;
            font-weight: 600;
            padding: 3px 8px;
            text-shadow: none;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: .25em;
        }
        span.l{
            background-color: #f8ac59;
            color: #fff;
            font-size: 10px;
            font-weight: 600;
            padding: 3px 8px;
            text-shadow: none;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: .25em;
        }
    </style>
</head>
<div id="container" style="padding: 20px">
    <div class="">
        <div><img src="./img/规则.jpg"/><img src="./img/元胞状态.png" width="365" /></div>
        <div class=".col-xs-6	.col-sm-6	.col-md-6	.col-lg-6">
            <!--<label>元素个数:
                <select >
                    <option>50</option>
                    <option>100</option>
                    <option>200</option>
                </select>
            </label>-->
            <!--<label>规则:
                <select >
                    <option>20</option>
                    <option>50</option>
                    <option>100</option>
                </select>
            </label>-->
            <label>规则(常用规则18,22,30,250)<input value="18" id="rule"></label>
            <button onclick="rand()">随机初始状态</button>
            <!--<label>迭代次数:
                <select >
                    <option>50</option>
                    <option>100</option>
                    <option>200</option>
                </select>
            </label>-->
<!--            <button onclick="start()" class="glyphicon glyphicon-play">开始</button>-->
            <button onclick="start2()" class="glyphicon glyphicon-play">开始</button>
        </div>
    </div>
    <div id="span">
        <div id="spans">
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="o"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span> 
            <span class="l"> </span>
            <span class="l"> </span> 
            <span class="l"> </span> 
        </div>
    </div>

</div>
<!-- 全局js -->
<script src="./js/jquery.min.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script type="text/javascript">
    function rand(){
        let children = $("#spans").children();
        // alert(children.length);
        for (let i = 0; i < children.length; i++) {
            let child = children[i];
            // alert($(child).attr("class"));
            let number = Math.round(Math.random());
            if(number == 0){
                $(child).attr("class", "o");
            }else{
                $(child).attr("class", "l");
            }
        }
    }
    //18  22  30  250
    function start2(){
        let r = $("#rule").val();
        let rule = getRule(Number(r));
        console.log('7 -> 111');
        console.log('6 -> 110');
        console.log('5 -> 101');
        console.log('4 -> 100');
        console.log('3 -> 011');
        console.log('2 -> 010');
        console.log('1 -> 001');
        console.log('0 -> 000');
        console.log('规则'+r+': '+rule);
        rule = rule.split('').reverse().join('');
        rule = rule.split('');
        console.log('规则'+r+'倒转: '+rule);

        //迭代100次
        for(var i = 0; i < 50; i++) {
            (function(i) {
                setTimeout(function() {
                    let $span = $("#span");

                    let lastdiv = $span.children(":last-child");
                    let chids = lastdiv.children();
                    let nextStatuss = [];
                    for (let i = 0; i < 50; i++) {
                        if(i != 0 && i != 49){
                            let attr = $(chids[i]).attr("class");
                            let before = $(chids[i-1]).attr("class");
                            let bihind = $(chids[i+1]).attr("class");
                            let n = (attr == "o")?0:1;
                            let nbefore = (before == "o")?0:1;
                            let nbihind = (bihind == "o")?0:1;
                            let status = ''+nbefore+n+nbihind;
                            let status2 = parseInt(status, 2);
                            let nextStatus = rule[status2];
                            // console.log('当前状态'+status2 +', 下一次状态'+ nextStatus);
                            nextStatuss[i] = nextStatus;
                        }else{
                            //边界保持永远是1
                            nextStatuss[i] = 1;
                        }
                    }


                    let d = $("<div></div>");
                    for (let i = 0; i < 50; i++) {
                        let number = nextStatuss[i];
                        if(number == 0 || number == '0'){
                            let span = "<span class=\"o\"> </span>  "
                            d.append(span);
                        }else{
                            let span = "<span class=\"l\"> </span>  "
                            d.append(span);
                        }
                    }
                    $span.append(d);
                }, (i + 1) * 500);
            })(i)
        }
    }
    function getRule(n){
        let s = n.toString(2);
        //高位补0
        while(s.length<8){
            s = '0'+s;
        }
        return s;
    }
    /*// 数据源
    var target = {
        state1: ['1', '2'],
        state2: ['01', '02', '03'],
        state3: ['001','002']
    }

    stackSituation(target)

    function stackSituation (data) {
        var targetKeys = Object.keys(data)
        var target = faker = []
        if (targetKeys.length) {
            target = targetKeys.map((key) => data[key])
            faker = target[0]
        }

        target.forEach((itemArr, index, currentArr) => {
            faker = js(faker, currentArr[index + 1])
        })
        function js(arr1, arr2){
            var arr1 = arr1 || []
            var arr2 = arr2 || []
            faker = []
            for(var i = 0;i < arr1.length; i++){
                if (!arr2.length) {
                    faker.push(arr1[i])
                } else {
                    for(var j = 0; j < arr2.length; j++){
                        faker.push(arr1[i] + '_' +arr2[j]);
                    }
                }
            }
            return faker
        }
        var result = faker.map((item) => item.split('_'))
        console.table(result)
        return result
    }
    function getNext(){
        let a1 = [1,2];
        let a2 = [4,3];

    }
    */
    /*let func = (arr) => {
        let len = arr.length
        let res = [] // 所有排列结果
        /!**
         * 【全排列算法】
         * 说明：arrange用来对arr中的元素进行排列组合，将排列好的各个结果存在新数组中
         * @param tempArr：排列好的元素
         * @param leftArr：待排列元素
         *!/
        let arrange = (tempArr, leftArr) => {
            if (tempArr.length === len) { // 这里就是递归结束的地方
                // res.push(tempArr) // 得到全排列的每个元素都是数组
                res.push(tempArr.join('')) // 得到全排列的每个元素都是字符串
            } else {
                leftArr.forEach((item, index) => {
                    let temp = [].concat(leftArr)
                    temp.splice(index, 1)
                    // 此时，第一个参数是当前分离出的元素所在数组；第二个参数temp是传入的leftArr去掉第一个后的结果
                    arrange(tempArr.concat(item), temp) // 这里使用了递归
                })
            }
        }
        arrange([], arr)
        return res
    }
    console.log('结果：', func(['0', '1', '2']));

    let a1 = [[0,1,2,3,4,5,6,7],[0,1,2,3,4,5,6,7] ,['0','1']];
    let results = [];
    let temp = [];
    function combine(arr, index = 0) {
        arr[index].forEach(item => {
            temp[index] = item

            index + 1 < arr.length
                ? combine(arr, index + 1)
                : results.push(temp.slice())
        })
    }
    // combine(a1);
    console.log(results);

    /!*返回组合的数组*!/
    function doExchange(array){
        var len = arr.length;
        // 当数组大于等于2个的时候
        if(len >= 2){
            // 第一个数组的长度
            var len1 = arr[0].length;
            // 第二个数组的长度
            var len2 = arr[1].length;
            // 2个数组产生的组合数
            var lenBoth = len1 * len2;
            //  申明一个新数组
            var items = new Array(lenBoth);
            // 申明新数组的索引
            var index = 0;
            for(var i=0; i<len1; i++){
                for(var j=0; j<len2; j++){
                    if(arr[0][i] instanceof Array){
                        items[index] = arr[0][i].concat(arr[1][j]);
                    }else{
                        items[index] = [arr[0][i]].concat(arr[1][j]);
                    }
                    index++;
                }
            }
            var newArr = new Array(len -1);
            for(var i=2;i<arr.length;i++){
                newArr[i-1] = arr[i];
            }
            newArr[0] = items;
            return doExchange(newArr);
        }else{
            return arr[0];
        }
    }
*/
    /*function start(){
        let $span = $("#span");

        for (let i = 0; i < 100; i++) {
            let d = $("<div></div>");
            let children = $("#spans").children();
            for (let i = 0; i < children.length; i++) {
                let number = Math.round(Math.random());
                if(number == 0){
                    let span = "<span class=\"o\"> </span>  "
                    d.append(span);
                }else{
                    let span = "<span class=\"l\"> </span>  "
                    d.append(span);
                }
            }
            $span.append(d);
            // sleep(3000)
        }
    }
    function sleep(n) { //n表示的毫秒数
        var start = new Date().getTime();
        while (true) {
            if (new Date().getTime() - start > n) {
                break
            }
        };
    }*/
</script>
</body>
</html>
